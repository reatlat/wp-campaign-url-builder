"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,a,e){return a&&n(t.prototype,a),e&&n(t,e),t}}();jQuery(function(g){var a=function(t){var n;return n={},window.location.href.replace(location.hash,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(t,a,e){n[a]=void 0!==e?e:""}),t?n[t]?n[t]:null:n};g.fn.simulateClick=function(){return this.each(function(){if("createEvent"in document){var t=this.ownerDocument,a=t.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,t.defaultView,1,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(a)}else this.click()})},g(document).ready(function(){var t=function(){function t(){_classCallCheck(this,t),this.plugin_name="Campaign-URL-Builder",this.ajax_url=REATLAT_CUB_APP.AJAXURL,this.debug_js=REATLAT_CUB_APP.DEBUG_JS,this._init(this)}return _createClass(t,[{key:"_init",value:function(t){this._debugLog("debug log activated"),this._triggers(this),this._copyToClipboard(),this._tippy(),this._formValidator(),this._formAjaxPost(this),g("#reatlat_cub_result__table").length&&this._tablePagination(this)}},{key:"_copyToClipboard",value:function(){this._debugLog("copy to clipboard activated"),new window.ClipboardJS("td[data-copy]")}},{key:"_triggers",value:function(t){g("td[data-copy]").on("click",function(t){t.preventDefault(),g(".reatlat_cub_notice--clipboard").show(),setTimeout(function(){g(".reatlat_cub_notice--clipboard").fadeOut("slow")},450)}),g(".reatlat_cub_add_custom-params").on("click",function(t){t.preventDefault(),1===g(".reatlat_cub_custom-params.disabled").length&&g(this).hide();var a=g(".reatlat_cub_custom-params.disabled").first();a.removeClass("disabled"),a.show()}),g(".reatlat_cub_tabs li a, a.reatlat_cub_tab_link").on("click",function(t){g(".reatlat_cub_tab, .reatlat_cub_tabs li a").removeClass("active"),g(this).addClass("active"),g(".reatlat_cub_tab."+g(this).attr("href").substr(1)+', .reatlat_cub_tabs li a[href="'+g(this).attr("href")+'"]').addClass("active")}),"reatlat_cub-settings-page"===a("page")&&"#reatlat_cub_tab-"===window.location.hash.substr(0,17)&&"0"!==window.location.hash.slice(-1)&&g('.reatlat_cub_tabs li a[href="'+window.location.hash+'"]').simulateClick()}},{key:"_tippy",value:function(){"function"==typeof tippy?(this._debugLog("TippyJS activated"),tippy(".tippy",{trigger:"click"}),tippy(".tippy--hover")):this._debugLog("TippyJS not founded")}},{key:"_formValidator",value:function(){this._debugLog("Run _formValidator()"),g("#reatlat_cub_campaign-form").validate({rules:{campaign_page:{required:!0,url:!0},campaign_name:{required:!0}}})}},{key:"_formAjaxPost",value:function(n){"reatlat_cub-settings-page"!==a("page")&&"edit"===a("action")&&g(".js-reatlat_cub--create-link").on("click",function(){return 9<g('input[name="campaign_page"]').val().length&&g('input[name="campaign_page"]').val().includes("//")&&"http"===g('input[name="campaign_page"]').val().slice(0,4)&&1<g('input[name="campaign_name"]').val().length&&g.ajax({type:"POST",url:ajaxurl,data:{action:"reatlat_cub_create_link",campaign_page:g('input[name="campaign_page"]').val(),campaign_source:g('select[name="campaign_source"]').val(),campaign_medium:g('select[name="campaign_medium"]').val(),campaign_name:g('input[name="campaign_name"]').val(),campaign_term:g('input[name="campaign_term"]').val(),campaign_content:g('input[name="campaign_content"]').val(),custom_key_1:g('input[name="custom_key_1"]').val(),custom_value_1:g('input[name="custom_value_1"]').val(),custom_key_2:g('input[name="custom_key_2"]').val(),custom_value_2:g('input[name="custom_value_2"]').val(),custom_key_3:g('input[name="custom_key_3"]').val(),custom_value_3:g('input[name="custom_value_3"]').val(),"Campaign-URL-Builder__submit_manage_links--nonce":g('input[name="Campaign-URL-Builder__submit_manage_links--nonce"]').val(),submit_manage_links:g('input[name="submit_manage_links"]').val()}}).done(function(t){if(t.result){g(".reatlat_cub_notice--success").show(),setTimeout(function(){g(".reatlat_cub_notice--success").fadeOut("slow")},450);var a='<tr class="reatlat_cub_yellow-highlight animated fadeInUp">';a+='<td class="campaign_info"></td>',a+='<td class="campaign_name"><strong>'+t.campaign_name+"</strong></td>",6<t.campaign_short_link.length?a+='<td class="campaign_short_link tippy--hover" data-clipboard-text="'+t.campaign_short_link+'" data-copy="true" data-original-title="Click cell to copy to clipboard">'+t.campaign_short_link+'<span class="dashicons dashicons-clipboard"></span></td>':a+='<td class="campaign_short_link">n/a</td>',a+='<td class="campaign_full_link tippy--hover" data-clipboard-text="'+t.campaign_full_link+'" data-copy="true" data-original-title="Click cell to copy to clipboard">'+t.campaign_full_link+'<span class="dashicons dashicons-clipboard"></span></td> ',g("td.campaign_user_id").length&&(a+="<td></td>"),a+="</tr>",1<g(".reatlat_cub_result__table_pagination").attr("data-page-count")?g(a).insertAfter(".reatlat_cub_result__table tbody tr.reatlat_cub_result__table__headrow"):g(a).insertBefore(".reatlat_cub_result__table tbody tr.reatlat_cub_link-on-list.first-link")}else g(".reatlat_cub_notice--error").show(),setTimeout(function(){g(".reatlat_cub_notice--error").fadeOut("slow")},1e3);return!1}),!1}),g(".js-export_to_csv").on("click",function(){return confirm("Campaign URL Builder\n\nExport UTM links list to CSV file?")&&g.ajax({type:"POST",url:ajaxurl,data:{action:"reatlat_cub_export_csv","Campaign-URL-Builder__export_to_csv--nonce":g('input[name="Campaign-URL-Builder__export_to_csv--nonce"]').val()}}).done(function(t){var a,e;"error"!==t?(window["Campaign-URL-Builder-WPAdmin"]._debugLog("Export to CSV status:",t),a=new Date,(e=document.createElement("a")).setAttribute("href","data:application/octet-stream,"+encodeURIComponent(t)),e.setAttribute("download","UTM_links_"+n._formatDate(a)+"-"+Math.floor(a.getTime()/1e3)+".csv"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)):console.log("Export to CSV status:  "+t)}),!1})}},{key:"_formatDate",value:function(t){var a=new Date(t),e=""+(a.getMonth()+1),n=""+a.getDate(),i=a.getFullYear();return e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),[i,e,n].join("-")}},{key:"_tablePagination",value:function(t){function n(t){var a=m,e=l*t-l;for(r=e;r<e+l&&r<o.length;r++)a+=o[r];i.innerHTML=a,tippy(".tippy--hover")}var i,l,a,e,o,r,c,u,s,_,p,d,m;if(i=document.getElementById("reatlat_cub_result__table"),s=g(".reatlat_cub_result__table_pagination"),_=g(".table_pagination__currentpage"),l=s.attr("data-rows-per-page")?parseInt(s.attr("data-rows-per-page")):10,a=i.rows.length,e=i.rows[0].firstElementChild.tagName,o=[],u=(d="TH"===e)?1:0,m=d?i.rows[0].outerHTML:"",p=Math.ceil((a-1)/l),s.attr("data-page-count",p),1<p){for(r=u,c=0;r<a;r++,c++)o[c]=i.rows[r].outerHTML;n(1),_.html("Page 1 of "+p)}g(".js-sortTable--prev").on("click",function(t){t.preventDefault();var a=parseInt(s.attr("data-current-page"));if(1<a){var e=a-1;n(e),s.attr("data-current-page",e),_.html("Page "+e+" of "+p)}}),g(".js-sortTable--next").on("click",function(t){t.preventDefault();var a=parseInt(s.attr("data-current-page"));if(a<p){var e=a+1;n(e),s.attr("data-current-page",e),_.html("Page "+e+" of "+p)}})}},{key:"_debugLog",value:function(){if(this.debug_js){for(var t,a=arguments.length,e=Array(a),n=0;n<a;n++)e[n]=arguments[n];(t=console).log.apply(t,["ðŸ¦„ "+this.plugin_name+" =>\n"].concat(e))}}}]),t}();window["Campaign-URL-Builder-WPAdmin"]=new t})});
//# sourceMappingURL=reatlat_cub-admin.min.js.map